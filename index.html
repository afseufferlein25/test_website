const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 200;

let score = 0;
let gameSpeed = 5;
let isGameOver = false;

const dino = {
    x: 50,
    y: 150,
    width: 40,
    height: 40,
    color: "#535353",
    dy: 0,
    jumpForce: 12,
    gravity: 0.6,
    grounded: false,
    jump() {
        // Only jump if on the ground
        if (this.grounded) {
            this.dy = -this.jumpForce;
            this.grounded = false;
        }
    },
    update() {
        // Apply Gravity
        this.dy += this.gravity;
        this.y += this.dy;

        // Ground Collision
        if (this.y + this.height > canvas.height) {
            this.y = canvas.height - this.height;
            this.dy = 0;
            this.grounded = true;
        }
    },
    draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    }
};

const obstacles = [];
function spawnObstacle() {
    let size = Math.random() * (50 - 20) + 20;
    obstacles.push({
        x: canvas.width,
        y: canvas.height - size,
        width: 20,
        height: size,
    });
}

// Key Listeners
window.addEventListener("keydown", (e) => {
    // Check for " " (Space) or "ArrowUp"
    if (e.key === " " || e.key === "ArrowUp") {
        e.preventDefault(); // Prevents the page from jumping down
        dino.jump();
    }
});

// Touch support for mobile/tablets
window.addEventListener("touchstart", (e) => {
    dino.jump();
});

let timer = 0;
function animate() {
    if (isGameOver) return;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    dino.update();
    dino.draw();

    timer++;
    if (timer % 100 === 0) spawnObstacle();

    for (let i = obstacles.length - 1; i >= 0; i--) {
        let obs = obstacles[i];
        obs.x -= gameSpeed;

        ctx.fillStyle = "#ff4d4d";
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);

        // Collision Check
        if (dino.x < obs.x + obs.width &&
            dino.x + dino.width > obs.x &&
            dino.y < obs.y + obs.height &&
            dino.y + dino.height > obs.y) {
            isGameOver = true;
            alert("Game Over! Score: " + score);
            location.reload(); // Restarts the game automatically
        }

        if (obs.x + obs.width < 0) {
            obstacles.splice(i, 1);
            score++;
        }
    }

    ctx.fillStyle = "#535353";
    ctx.font = "20px Courier";
    ctx.fillText(`Score: ${score}`, 680, 30);

    requestAnimationFrame(animate);
}

animate();
